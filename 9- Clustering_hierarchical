# -*- coding: utf-8 -*-
"""
Created on Thu May 22 08:53:45 2025

@author: Lenovo
"""

import pandas as pd
import matplotlib.pyplot as plt

def nullCount(data):
    
    null_count = data.isnull().sum()
    null_percentage = (data.isnull().sum() / len(data)) * 100

    # Combine into a single DataFrame
    null_summary = pd.DataFrame({
        'Null_Count': null_count,
        'Null_Percentage': null_percentage
    })
    
    return null_summary

def one_hot_encode_columns(data, columns):
    """
    One-hot encodes specified columns in a DataFrame (with drop_first=True) and returns the updated DataFrame.
    
    Parameters:
    - data (pd.DataFrame): The input DataFrame.
    - columns (list): List of column names to one-hot encode.
    
    Returns:
    - pd.DataFrame: The transformed DataFrame with one-hot encoded columns.
    """
    data = data.copy()
    dummies_list = []
    
    for col in columns:
        if col in data.columns:
            dummies = pd.get_dummies(data[col], prefix=col, drop_first=True)
            dummies_list.append(dummies)
            data = data.drop(col, axis=1)
    
    if dummies_list:
        data = pd.concat([data] + dummies_list, axis=1)
    
    return data

# reading data    
data = pd.read_csv(r"Hotel Reservations.csv")

# checking null data
null_count = nullCount(data)

numeric_cols = data.select_dtypes(exclude=['object']).columns.tolist()
string_cols = data.select_dtypes(include=['object']).columns.tolist()

# removing non required columns
remove_cols = ['no_of_previous_cancellations', 'no_of_previous_bookings_not_canceled', 'booking_status', 'Booking_ID', 'arrival_year', 'arrival_month', 'arrival_date']
numeric_cols = [col for col in numeric_cols if col not in remove_cols]
string_cols = [col for col in string_cols if col not in remove_cols]

data = data[numeric_cols + string_cols]

# One-hot encode
cols_to_one_hot_encode = ['type_of_meal_plan', 'room_type_reserved', 'market_segment_type']
data = one_hot_encode_columns(data, cols_to_one_hot_encode)

# ordinal encode
cols_to_ordinal_encode = []
unique_values = {col: data[col].unique() for col in cols_to_ordinal_encode}

order_dict = {}

# data scaling
from sklearn.preprocessing import MinMaxScaler

scaler = MinMaxScaler()
x_train = data.copy()
x_train = scaler.fit_transform(x_train)

# Apply agglomerative clustering
from sklearn.cluster import AgglomerativeClustering


clustering = AgglomerativeClustering( n_clusters = None,
                                      linkage = 'complete',
                                      distance_threshold = 0.5, # if n_clusters is number then this should be None
                                      metric = 'cosine')
clustering.fit(x_train)

# silhouette_score
from sklearn.metrics import silhouette_score

silhouette_score(x_train, clustering.labels_)
